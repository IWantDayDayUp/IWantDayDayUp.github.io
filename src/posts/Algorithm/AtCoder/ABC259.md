---
# Author
author:
name: TayLock
url: https://iwantdaydayup.github.io

# Date
date: 2022-06-28

# Original
# isOriginal: true

# Category
category:
  - Algorithm
  - AtCoder Beginner Contest

# Tag
tag:
  - DP
  - Tree DP
---

# ğŸ§© AtCoder Beginner Contest 259

## # Info & Summary

- **Date:** `2022-06-28`
- **Completion Status:** A âœ… / B âœ… / C âœ… / D âœ… / E âŒ / F âŒ / G âŒ
- **Problem Type**:
  - E: `Tree DP`

---

## 1. é¢˜ç›®

ä¸€æ£µæ ‘æœ‰ $n$ ä¸ªèŠ‚ç‚¹, $n - 1$ æ¡è¾¹, æ¯æ¡è¾¹è¿æ¥èŠ‚ç‚¹ $u_i$ å’Œ $v_i$, æƒé‡ä¸º $w_i$

ç°åœ¨éœ€è¦ä» $n - 1$ æ¡è¾¹ä¸­é€‰æ‹©è‹¥å¹²æ¡(å¯ä»¥ä¸º 0), ä½¿å¾—æ‰€æœ‰è¢«é€‰æ‹©çš„è¾¹çš„ `æƒé‡å’Œæœ€å¤§`

å¯¹äºæ¯ä¸ªèŠ‚ç‚¹(1, ..., n)æ¥è¯´, æœ€å¤šé€‰æ‹© $d_i$ æ¡é‚»æ¥è¾¹

## 2. åˆ†æ

å¯¹äºèŠ‚ç‚¹ `v`, å®šä¹‰å¦‚ä¸‹:

- $dp_{<=}[v]$: ä»å­æ ‘ $v$ ä¸­é€‰æ‹© `è‡³å¤š` $d_v$ æ¡ $v$ çš„é‚»æ¥è¾¹, æ‰€èƒ½å¾—åˆ°çš„æœ€å¤§æƒé‡å’Œ

- $dp_{<}[v]$: ä»å­æ ‘ $v$ ä¸­é€‰æ‹© `ä¸¥æ ¼å°äº` $d_v$ æ¡ $v$ çš„é‚»æ¥è¾¹, æ‰€èƒ½å¾—åˆ°çš„æœ€å¤§æƒé‡å’Œ

å¯¹äºèŠ‚ç‚¹ $v$ çš„æ¯ä¸€æ¡é‚»æ¥è¾¹ $(v, u)$, æœ‰ä¸¤ç§æƒ…å†µ:

- é€‰æ‹©: ç”±äºè¾¹ $(v, u)$ å ç”¨èŠ‚ç‚¹ $u$ çš„åé¢, å¯¹å­æ ‘ $u$ æ¥è¯´, æ­¤æ—¶åªèƒ½é€‰æ‹© `ä¸¥æ ¼å°äº` $d_u$ æ¡é‚»æ¥è¾¹, å³: $dp_{<}[u]$

  æ­¤æ—¶, èŠ‚ç‚¹ $v$ ä»å­æ ‘ $v$ ä¸­èƒ½è·å¾—çš„æœ€å¤§æƒé‡å’Œä¸º: $S_u = w + dp_{<}[u]$

- ä¸é€‰æ‹©: è¾¹ $(v, u)$ ä¸ä¼šå ç”¨åé¢, å­æ ‘ $u$ ä»ç„¶å¯ä»¥é€‰æ‹©è‡³å¤š $d_u$ æ¡é‚»æ¥è¾¹

  æ­¤æ—¶çš„æœ€å¤§æƒé‡å’Œä¸º: $S_u = dp_{<=}[u]$

å› æ­¤, è¯¥é—®é¢˜å¯ä»¥ç­‰ä»·äº:

> å¯¹äº èŠ‚ç‚¹ $v$ çš„æ‰€æœ‰å­èŠ‚ç‚¹, å¯ä»¥æ‰§è¡Œé€‰æ‹©ä¸Šè¿°ä¸¤ä¸ªæ“ä½œ(æ“ä½œ 1 ä¸ºé€‰æ‹©, æ“ä½œ 2 ä¸ºä¸é€‰æ‹©), å¹¶ä¸”æ“ä½œ 1 è‡³å¤šå¯ä»¥é€‰æ‹© $d_v$ æ¬¡, æ±‚å¯ä»¥å¾—åˆ°çš„æœ€å¤§æƒé‡å’Œ

å¯¹äºèŠ‚ç‚¹ $v$ çš„æŸä¸ªå­èŠ‚ç‚¹ $u$ æ¥è¯´, è‹¥åˆšå¼€å§‹é€‰æ‹© `æ“ä½œ2`, å³: ä¸é€‰è¾¹$(v, u)$, ç„¶åè½¬è€Œé€‰æ‹© `æ“ä½œ1`, å³: é€‰æ‹©è¾¹$(v, u)$, (å…¶ä»–å­èŠ‚ç‚¹æ“ä½œä¸å˜)

æ­¤æ—¶, å­æ ‘ $u$ çš„æœ€å¤§æƒé‡å’Œ $S_u$ çš„å˜åŒ–é‡ä¸º: $\Delta = w + dp_{<}[u] - dp_{<=}[u]$

ä¸ºäº†è§£å†³ä¸Šè¿°é—®é¢˜, å¯ä»¥å°† $v$ çš„æ‰€æœ‰å­èŠ‚ç‚¹åˆå§‹éƒ½é€‰æ‹© `æ“ä½œ2`, ç„¶åä¾æ¬¡æ›´æ”¹ä¸º `æ“ä½œ1`, å¹¶è®°å½•å…¶æœ€å¤§æƒé‡å’Œçš„å˜åŒ–é‡ $\Delta$

ç„¶å, è´ªå¿ƒåœ°é€‰æ‹©: 1. å˜åŒ–é‡è¾ƒå¤§ä¸”å¤§äº 0 2. æ“ä½œæ›´æ”¹ä¸è¶…è¿‡ $d_v$ æ¬¡

å¦å¤–, å­˜åœ¨ç‰¹æ®Šæƒ…å†µ, å½“ $d_v == 0$:

- $dp_{<=}[v]$: é€‰æ‹©çš„è¾¹æ•°å¯ä»¥ `<=` 0, ç»“æœä¸º $0$

- $dp_{<}[v]$: é€‰æ‹©çš„è¾¹æ•°ä¸å¯ä»¥ `ä¸¥æ ¼å°äº` 0, ç»“æœä¸º $-inf$

## 3. ä»£ç 

```cpp
#include <bits/stdc++.h>

using namespace std;

int main()
{
    ios::sync_with_stdio(false);
    cin.tie(0);

    int n;
    cin >> n;

    vector<int> d(n);
    for (int i = 0; i < n; i++)
    {
        cin >> d[i];
    }

    vector<vector<pair<int, int>>> adj(n);
    for (int i = 0; i < n - 1; i++)
    {
        int x, y, z;
        cin >> x >> y >> z;
        --x;
        --y;
        adj[x].emplace_back(make_pair(y, z));
        adj[y].emplace_back(make_pair(x, z));
    }

    const long long inf = (long long)1e18;
    // dp[i][0]: é€‰æ‹©çš„è¾¹æ•° `ä¸¥æ ¼å°äº` d_i
    // dp[i][1]: é€‰æ‹©çš„å˜æ•° `å°äºç­‰äº` d_i
    vector<vector<long long>> dp(n, vector<long long>(2, 0));

    function<void(int, int)> dfs = [&](int u, int p)
    {
        // å¯¹äºå­èŠ‚ç‚¹ u æ¥è¯´, å®ƒæœ€å¤šé€‰ d_u æ¡é‚»æ¥è¾¹
        // å¯¹äºèŠ‚ç‚¹ u çš„æ‰€æœ‰é‚»æ¥è¾¹æ¥è¯´, éƒ½æœ‰ä¸¤ä¸ªé€‰æ‹©:
        // 1. é€‰(æœ€å¤šé€‰d_uæ¡)
        // 2. ä¸é€‰

        // å¯¹äºèŠ‚ç‚¹ u çš„æŸä¸ªå­èŠ‚ç‚¹ v æ¥è¯´, è¾¹(u, v)æœ‰ä¸¤ç§æƒ…å†µ:

        // 1. é€‰
        // sum_u = dp[v][0] + w (å› ä¸ºè¾¹(u, v)å ç”¨ä¸€æ¡è¾¹, èŠ‚ç‚¹væœ€å¤šé€‰æ‹© `d_v - 1` æ¡)


        // 2. ä¸é€‰
        // sum_u = dp[v][0] (è¾¹(u, v)ä¸å ç”¨åé¢, èŠ‚ç‚¹væœ€å¤šé€‰æ‹© `d_v` æ¡è¾¹)

        // å› æ­¤: å¯¹äºè¾¹(u, v)æ¥è¯´:
        // ä¸é€‰ -> é€‰ å¼•èµ·çš„sumå˜åŒ–é‡ä¸º: dp[v][0] + w - dp[v][1]
        // è®°å½•æ‰€æœ‰å­èŠ‚ç‚¹å¼•èµ·çš„å˜åŒ–é‡:
        // åªé€‰: 1. å˜åŒ–é‡å¤§äº0   2. æœ€å¤šd_uä¸ª

        vector<long long> vec;
        for (auto & pa : adj[u])
        {
            int v = pa.first, w = pa.second;
            if (v == p) continue;
            dfs(v, u);

            // è®°å½•å˜åŒ–é‡
            vec.emplace_back(dp[v][0] + w - dp[v][1]);

            // åˆå§‹, ä¸é€‰è¾¹(u, v), åé¢å†æ ¹æ®å˜åŒ–é‡å°† `ä¸é€‰` æ”¹ä¸º `é€‰`
            dp[u][0] += dp[v][1];
            dp[u][1] += dp[v][1];
        }

        // æŒ‰å˜åŒ–é‡, é™åº
        sort(vec.rbegin(), vec.rend());

        for (int i = 0; i < (int)vec.size(); i++)
        {
            // åªé€‰å˜åŒ–é‡å¤§äº0çš„(é¢˜ç›®é—®æœ€å¤§)
            if (vec[i] <= 0) break;

            // dp[u][0]: é‚»æ¥è¾¹çš„é€‰æ‹©æ•°é‡ `ä¸¥æ ¼å°äº` d_u (å› ä¸ºè¾¹(uçˆ¶èŠ‚ç‚¹, u)å ç”¨åé¢)
            if (i < d[u] - 1)
            {
                dp[u][0] += vec[i];
            }
            // dp[u][1]: é‚»æ¥è¾¹çš„é€‰æ‹©æ•°é‡ `å°äºç­‰äº` d_u
            if (i < d[u])
            {
                dp[u][1] += vec[i];
            }
        }

        // èŠ‚ç‚¹ u ä¸€æ¡é‚»æ¥è¾¹éƒ½ä¸èƒ½é€‰
        if (d[u] == 0)
        {
            dp[u][0] = -inf;
        }
    };

    dfs(0, -1);

    cout << dp[0][1] << endl;

    return 0;
}

```
